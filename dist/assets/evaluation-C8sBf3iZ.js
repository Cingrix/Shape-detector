import{S as E}from"./index-C09ss9qB.js";import{testImages as M,getAllTestImageNames as k}from"./test-images-data-Cm1tjClX.js";function N(t,o){const a=Math.max(t.x,o.x),e=Math.max(t.y,o.y),c=Math.min(t.x+t.width,o.x+o.width),s=Math.min(t.y+t.height,o.y+o.height);if(c<=a||s<=e)return 0;const n=(c-a)*(s-e),i=t.width*t.height+o.width*o.height-n;return n/i}function j(t,o){return Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2))}function U(t,o){let e=0,c=0,s=0,n=0,i=0;const u=new Set;for(const p of t){let h=null,r=0,f=-1;for(let m=0;m<o.length;m++){if(u.has(m))continue;const F=o[m];if(p.type!==F.type)continue;const $=N(p.boundingBox,F.bounding_box);$>r&&$>.5&&(h=F,r=$,f=m)}if(h){if(u.add(f),e++,c+=r,h.center&&p.center){const m=j(p.center,h.center);s+=m}if(h.area&&p.area){const m=Math.abs(p.area-h.area)/h.area;n+=m}if(h.confidence_expected&&p.confidence){const m=Math.abs(p.confidence-h.confidence_expected);i+=m}}}const g=t.length>0?e/t.length:0,d=o.length>0?e/o.length:1,y=g+d>0?2*(g*d)/(g+d):0;return{precision:g,recall:d,f1_score:y,average_iou:e>0?c/e:0,center_point_accuracy:e>0?s/e:0,area_accuracy:e>0?1-n/e:0,confidence_calibration:e>0?1-i/e:0,processing_time:0}}let R=null;async function D(){if(!R)try{R=await(await fetch("/ground_truth.json")).json()}catch(t){throw console.error("Failed to load ground truth data:",t),t}return R}async function H(t,o){const a=await D(),e=[];let c=0,s=0,n=0,i=0,u=0,g=0;for(const r of o){console.log(`Testing selected: ${r}`);try{const f=M[r],F=await(await fetch(f)).blob(),$=new File([F],r,{type:"image/svg+xml"}),x=document.createElement("canvas"),_=await new E(x).loadImage($),v=await t.detectShapes(_),w=a.images[r]?.shapes||[],l=U(v.shapes,w);l.processing_time=v.processingTime;const{passed:T,feedback:S,score:I}=P(l,v);c+=l.precision,s+=l.recall,n+=l.f1_score,i+=l.average_iou,u+=l.processing_time,g+=I,e.push({imageName:r,detectionResult:v,evaluation:l,passed:T,feedback:S})}catch(f){console.error(`Error testing ${r}:`,f),e.push({imageName:r,detectionResult:{shapes:[],processingTime:0,imageWidth:0,imageHeight:0},evaluation:{precision:0,recall:0,f1_score:0,average_iou:0,center_point_accuracy:0,area_accuracy:0,confidence_calibration:0,processing_time:0},passed:!1,feedback:[`Error during testing: ${f}`]})}}const d=e.length,y=d*100,p=g/y*100,h={totalScore:Math.round(g),maxScore:y,percentage:Math.round(p*100)/100,grade:b(p),testResults:e,summary:{averagePrecision:c/d,averageRecall:s/d,averageF1:n/d,averageIoU:i/d,totalProcessingTime:u}};return console.log("Selected evaluation complete!"),h}async function B(t){const o=await D(),a=[],e=k();let c=0,s=0,n=0,i=0,u=0,g=0;for(const r of e){console.log(`Testing: ${r}`);try{const f=M[r],F=await(await fetch(f)).blob(),$=new File([F],r,{type:"image/svg+xml"}),x=document.createElement("canvas"),_=await new E(x).loadImage($),v=await t.detectShapes(_),w=o.images[r]?.shapes||[],l=U(v.shapes,w);l.processing_time=v.processingTime;const{passed:T,feedback:S,score:I}=P(l,v);c+=l.precision,s+=l.recall,n+=l.f1_score,i+=l.average_iou,u+=l.processing_time,g+=I,a.push({imageName:r,detectionResult:v,evaluation:l,passed:T,feedback:S})}catch(f){console.error(`Error testing ${r}:`,f),a.push({imageName:r,detectionResult:{shapes:[],processingTime:0,imageWidth:0,imageHeight:0},evaluation:{precision:0,recall:0,f1_score:0,average_iou:0,center_point_accuracy:0,area_accuracy:0,confidence_calibration:0,processing_time:0},passed:!1,feedback:[`Error during testing: ${f}`]})}}const d=a.length,y=d*100,p=g/y*100,h={totalScore:Math.round(g),maxScore:y,percentage:Math.round(p*100)/100,grade:b(p),testResults:a,summary:{averagePrecision:c/d,averageRecall:s/d,averageF1:n/d,averageIoU:i/d,totalProcessingTime:u}};return console.log("Evaluation complete!"),h}function P(t,o){const a=[];let e=0;const c=t.f1_score;c>=.9?(e+=40,a.push(`detection accuracy (F1: ${c.toFixed(3)})`)):c>=.7?(e+=30,a.push(`detection accuracy (F1: ${c.toFixed(3)})`)):c>=.5?(e+=20,a.push(`detection accuracy (F1: ${c.toFixed(3)})`)):a.push(`detection accuracy (F1: ${c.toFixed(3)})`);const s=t.average_iou;s>=.8?(e+=25,a.push(`✓ Excellent localization (IoU: ${s.toFixed(3)})`)):s>=.6?(e+=20,a.push(`✓ Good localization (IoU: ${s.toFixed(3)})`)):s>=.4?(e+=10,a.push(`△ Fair localization (IoU: ${s.toFixed(3)})`)):a.push(`✗ Poor localization (IoU: ${s.toFixed(3)})`);const n=t.center_point_accuracy;n<=5?(e+=15,a.push(`center accuracy (${n.toFixed(1)}px error)`)):n<=10?(e+=12,a.push(`center accuracy (${n.toFixed(1)}px error)`)):n<=20?(e+=8,a.push(`center accuracy (${n.toFixed(1)}px error)`)):a.push(`center accuracy (${n.toFixed(1)}px error)`);const i=t.area_accuracy;i>=.9?(e+=10,a.push(`area calculation (${(i*100).toFixed(1)}% accuracy)`)):i>=.8?(e+=8,a.push(`area calculation (${(i*100).toFixed(1)}% accuracy)`)):i>=.7?(e+=5,a.push(`area calculation (${(i*100).toFixed(1)}% accuracy)`)):a.push(`area calculation (${(i*100).toFixed(1)}% accuracy)`);const u=o.processingTime;return u<=500?(e+=10,a.push(`performance (${u.toFixed(0)}ms)`)):u<=1e3?(e+=8,a.push(`performance (${u.toFixed(0)}ms)`)):u<=2e3?(e+=5,a.push(`performance (${u.toFixed(0)}ms)`)):a.push(`performance (${u.toFixed(0)}ms)`),{passed:e>=60,feedback:a,score:e}}function b(t){return t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F"}function C(t,o){const a=`
    <div class="evaluation-results">
      <h2>Evaluation Results</h2>
      <div class="summary">
        <h4>Summary Metrics:</h4>
        <ul>
          <li>Average Precision: ${(t.summary.averagePrecision*100).toFixed(1)}%</li>
          <li>Average Recall: ${(t.summary.averageRecall*100).toFixed(1)}%</li>
          <li>Average F1 Score: ${t.summary.averageF1.toFixed(3)}</li>
          <li>Average IoU: ${t.summary.averageIoU.toFixed(3)}</li>
          <li>Total Processing Time: ${t.summary.totalProcessingTime.toFixed(0)}ms</li>
        </ul>
      </div>
      
      <div class="detailed-results">
        <h4>Detailed Results:</h4>
        ${t.testResults.map(e=>`
          <div class="test-result ${e.passed?"passed":"failed"}">
            <h5>${e.imageName} ${e.passed?"✓":"x"}</h5>
            <p><strong>Detected:</strong> ${e.detectionResult.shapes.length} shapes</p>
            <p><strong>Processing Time:</strong> ${e.detectionResult.processingTime.toFixed(0)}ms</p>
            <div class="feedback">
              ${e.feedback.map(c=>`<p>${c}</p>`).join("")}
            </div>
          </div>
        `).join("")}
      </div>
    </div>
  `;o.innerHTML=a}export{C as displayEvaluationResults,B as runEvaluation,H as runSelectedEvaluation};
