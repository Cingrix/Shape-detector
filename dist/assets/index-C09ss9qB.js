const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/evaluation-C8sBf3iZ.js","assets/test-images-data-Cm1tjClX.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const O="modulepreload",k=function(v){return"/"+v},T={},R=function(t,s,o){let e=Promise.resolve();if(s&&s.length>0){let f=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");e=f(s.map(l=>{if(l=k(l),l in T)return;T[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":O,u||(c.as="script"),c.crossOrigin="",c.href=l,i&&c.setAttribute("nonce",i),document.head.appendChild(c),u)return new Promise((m,p)=>{c.addEventListener("load",m),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return e.then(a=>{for(const i of a||[])i.status==="rejected"&&n(i.reason);return t().catch(n)})};class F{selectedImages=new Set;setupSelectionControls(){const t=document.getElementById("selectAllBtn"),s=document.getElementById("deselectAllBtn");t?.addEventListener("click",()=>{document.querySelectorAll(".test-image-item").forEach(e=>{const n=e.getAttribute("data-image");n&&(this.selectedImages.add(n),e.classList.add("selected"))}),this.updateSelectionInfo()}),s?.addEventListener("click",()=>{this.selectedImages.clear(),document.querySelectorAll(".test-image-item").forEach(o=>{o.classList.remove("selected")}),this.updateSelectionInfo()})}toggleImageSelection(t){const s=document.querySelector(`[data-image="${t}"]`);s&&(this.selectedImages.has(t)?(this.selectedImages.delete(t),s.classList.remove("selected")):(this.selectedImages.add(t),s.classList.add("selected")),this.updateSelectionInfo())}updateSelectionInfo(){const t=document.querySelector(".selection-info");t&&(t.textContent=`${this.selectedImages.size} images selected`)}getSelectedImages(){return Array.from(this.selectedImages)}hasSelections(){return this.selectedImages.size>0}}class H{static showEvaluationModal(t){const s=document.createElement("div");s.className="modal-overlay";const o=document.createElement("div");o.className="modal-content";const e=document.createElement("button");e.className="modal-close",e.innerHTML="√ó",e.onclick=()=>{document.body.removeChild(s)};const n=document.createElement("div");R(()=>import("./evaluation-C8sBf3iZ.js"),__vite__mapDeps([0,1])).then(i=>{i.displayEvaluationResults(t,n)}),o.appendChild(e),o.appendChild(n),s.appendChild(o),document.body.appendChild(s),s.addEventListener("click",i=>{i.target===s&&document.body.removeChild(s)});const a=i=>{i.key==="Escape"&&(document.body.removeChild(s),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a)}}class U{detector;evaluateButton;evaluationResultsDiv;constructor(t,s,o){this.detector=t,this.evaluateButton=s,this.evaluationResultsDiv=o}async runSelectedEvaluation(t){if(t.length===0){alert("Please select at least one image for evaluation (right-click to select)");return}try{this.evaluateButton.disabled=!0,this.evaluateButton.textContent="Evaluating...";const o=await(await R(()=>import("./evaluation-C8sBf3iZ.js"),__vite__mapDeps([0,1]))).runSelectedEvaluation(this.detector,t);H.showEvaluationModal(o),console.log("Selected Evaluation Results:",o)}catch(s){alert(`Error during evaluation: ${s}`),console.error("Evaluation error:",s)}finally{this.evaluateButton.disabled=!1,this.evaluateButton.textContent="Run Selected Evaluation"}}async runFullEvaluation(){try{this.evaluateButton.disabled=!0,this.evaluationResultsDiv.innerHTML="<p>Running comprehensive evaluation...</p>";const t=await R(()=>import("./evaluation-C8sBf3iZ.js"),__vite__mapDeps([0,1])),s=await t.runEvaluation(this.detector);t.displayEvaluationResults(s,this.evaluationResultsDiv),console.log("Full Evaluation Results:",s)}catch(t){this.evaluationResultsDiv.innerHTML=`<p>Error during evaluation: ${t}</p>`,console.error("Evaluation error:",t)}finally{this.evaluateButton.disabled=!1}}}class q{canvas;ctx;constructor(t){this.canvas=t,this.ctx=t.getContext("2d")}async detectShapes(t){const s=performance.now(),o=[];if(!window.cv)throw new Error("OpenCV is not loaded.");const e=window.cv,n=e.matFromImageData(t),a=new e.Mat;e.cvtColor(n,a,e.COLOR_RGBA2GRAY);const i=new e.Mat;e.bilateralFilter(a,i,9,75,75);const f=new e.Mat;e.Canny(i,f,50,100);const l=new e.MatVector,u=new e.Mat;e.findContours(f,l,u,e.RETR_EXTERNAL,e.CHAIN_APPROX_SIMPLE);for(let c=0;c<l.size();++c){const m=l.get(c),p=new e.Mat,$=e.arcLength(m,!0);e.approxPolyDP(m,p,.04*$,!0);const w=p.rows,b=e.contourArea(m),M=e.boundingRect(m);if(b<100)continue;let y=null,C=.85;if(w===3)y="triangle";else if(w===4)y="rectangle";else if(w===5)y="pentagon";else if(w>5){const{radius:E}=e.minEnclosingCircle(m),D=Math.PI*E*E,_=b/D;if(_>.85)y="circle",C=_;else if(w===10&&!e.isContourConvex(m)){const x=[],I=[];for(let r=0;r<p.rows;r++)I.push({x:p.data32S[r*2],y:p.data32S[r*2+1]});for(let r=0;r<I.length;r++){const S=I[r],d=I[(r+1)%I.length],g=I[(r+2)%I.length];let P=(Math.atan2(g.y-d.y,g.x-d.x)-Math.atan2(S.y-d.y,S.x-d.x))*180/Math.PI;P<0&&(P+=360),x.push(P)}const A=x.filter(r=>r<120),B=x.filter(r=>r>120);if(A.length===5&&B.length===5){const r=Math.sqrt(A.map(d=>Math.pow(d-A.reduce((g,L)=>g+L)/5,2)).reduce((d,g)=>d+g)/5),S=Math.sqrt(B.map(d=>Math.pow(d-B.reduce((g,L)=>g+L)/5,2)).reduce((d,g)=>d+g)/5);r<30&&S<30&&(y="star",C=1-(r+S)/60)}}}if(y){const E=e.moments(m),D={x:E.m10/E.m00,y:E.m01/E.m00};o.push({type:y,confidence:C,boundingBox:{x:M.x,y:M.y,width:M.width,height:M.height},center:D,area:b})}p.delete(),m.delete()}n.delete(),a.delete(),i.delete(),f.delete(),l.delete(),u.delete();const h=performance.now()-s;return{shapes:o,processingTime:h,imageWidth:t.width,imageHeight:t.height}}loadImage(t){return new Promise((s,o)=>{const e=new Image;e.onload=()=>{this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const n=this.ctx.getImageData(0,0,e.width,e.height);s(n)},e.onerror=o,e.src=URL.createObjectURL(t)})}}class N{detector;imageInput;resultsDiv;testImagesDiv;evaluateButton;evaluationResultsDiv;selectionManager;evaluationManager;constructor(){const t=document.getElementById("originalCanvas");this.detector=new q(t),this.imageInput=document.getElementById("imageInput"),this.resultsDiv=document.getElementById("results"),this.testImagesDiv=document.getElementById("testImages"),this.evaluateButton=document.getElementById("evaluateButton"),this.evaluationResultsDiv=document.getElementById("evaluationResults"),this.selectionManager=new F,this.evaluationManager=new U(this.detector,this.evaluateButton,this.evaluationResultsDiv),this.setupEventListeners(),this.loadTestImages().catch(console.error)}setupEventListeners(){this.imageInput.addEventListener("change",async t=>{const s=t.target.files?.[0];s&&await this.processImage(s)}),this.evaluateButton.addEventListener("click",async()=>{const t=this.selectionManager.getSelectedImages();await this.evaluationManager.runSelectedEvaluation(t)})}async processImage(t){try{this.resultsDiv.innerHTML="<p>Processing...</p>";const s=await this.detector.loadImage(t),o=await this.detector.detectShapes(s);this.displayResults(o)}catch(s){this.resultsDiv.innerHTML=`<p>Error: ${s}</p>`}}displayResults(t){const{shapes:s,processingTime:o}=t;let e=`
      <p><strong>Processing Time:</strong> ${o.toFixed(2)}ms</p>
      <p><strong>Shapes Found:</strong> ${s.length}</p>
    `;s.length>0?(e+="<h4>Detected Shapes:</h4><ul>",s.forEach(n=>{e+=`
          <li>
            <strong>${n.type.charAt(0).toUpperCase()+n.type.slice(1)}</strong><br>
            Confidence: ${(n.confidence*100).toFixed(1)}%<br>
            Center: (${n.center.x.toFixed(1)}, ${n.center.y.toFixed(1)})<br>
            Area: ${n.area.toFixed(1)}px¬≤
          </li>
        `}),e+="</ul>"):e+="<p>No shapes detected. Please implement the detection algorithm.</p>",this.resultsDiv.innerHTML=e}async loadTestImages(){try{const t=await R(()=>import("./test-images-data-Cm1tjClX.js"),[]),s=t.testImages,o=t.getAllTestImageNames();let e='<h4>Click to upload your own image or use test images for detection. Right-click test images to select/deselect for evaluation:</h4><div class="evaluation-controls"><button id="selectAllBtn">Select All</button><button id="deselectAllBtn">Deselect All</button><span class="selection-info">0 images selected</span></div><div class="test-images-grid">';e+=`
        <div class="test-image-item upload-item" onclick="triggerFileUpload()">
          <div class="upload-icon">üìÅ</div>
          <div class="upload-text">Upload Image</div>
          <div class="upload-subtext">Click to select file</div>
        </div>
      `,o.forEach(n=>{const a=s[n],i=n.replace(/[_-]/g," ").replace(/\.(svg|png)$/i,"");e+=`
          <div class="test-image-item" data-image="${n}" 
               onclick="loadTestImage('${n}', '${a}')" 
               oncontextmenu="toggleImageSelection(event, '${n}')">
            <img src="${a}" alt="${n}">
            <div>${i}</div>
          </div>
        `}),e+="</div>",this.testImagesDiv.innerHTML=e,this.selectionManager.setupSelectionControls(),window.loadTestImage=async(n,a)=>{try{const f=await(await fetch(a)).blob(),l=new File([f],n,{type:"image/svg+xml"}),u=await this.detector.loadImage(l),h=await this.detector.detectShapes(u);this.displayResults(h),console.log(`Loaded test image: ${n}`)}catch(i){console.error("Error loading test image:",i)}},window.toggleImageSelection=(n,a)=>{n.preventDefault(),this.selectionManager.toggleImageSelection(a)},window.triggerFileUpload=()=>{this.imageInput.click()}}catch{this.testImagesDiv.innerHTML=`
        <p>Test images not available. Run 'node convert-svg-to-png.js' to generate test image data.</p>
        <p>SVG files are available in the test-images/ directory.</p>
      `}}}document.addEventListener("DOMContentLoaded",()=>{new N});export{q as S};
